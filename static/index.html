<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Exam Verification Console</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    section { margin-bottom: 24px; }
    input, button { margin: 6px 0; }
    .row { display: flex; gap: 24px; }
    .card { padding: 12px; border: 1px solid #ccc; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Exam Verification Console</h1>
  <section class="card">
    <h3>Start Exam Session</h3>
    <label>User ID: <input id="userId" type="number" /></label><br/>
    <label>Duration (minutes): <input id="duration" type="number" value="60"/></label><br/>
    <button onclick="startSession()">Start Session</button>
    <div id="sessionInfo"></div>
  </section>
  <div class="row">
    <section class="card">
      <h3>Start Verification</h3>
      <div>Face: <input id="startFace" type="file" accept="image/*"/></div>
      <button onclick="verifyFace('start')">Verify Face (Start)</button>
      <div>Voice: <input id="startVoice" type="file" accept="audio/*"/></div>
      <button onclick="verifyVoice('start')">Verify Voice (Start)</button>
      <div id="startResult"></div>
    </section>
    <section class="card">
      <h3>End Verification</h3>
      <div>Face: <input id="endFace" type="file" accept="image/*"/></div>
      <button onclick="verifyFace('end')">Verify Face (End)</button>
      <div>Voice: <input id="endVoice" type="file" accept="audio/*"/></div>
      <button onclick="verifyVoice('end')">Verify Voice (End)</button>
      <div id="endResult"></div>
    </section>
  </div>
  <section class="card">
    <h3>Submit Exam</h3>
    <button onclick="submitSession()">Submit Session</button>
    <div id="submitInfo"></div>
  </section>
  <section class="card">
    <h3>Session Metrics</h3>
    <button onclick="getMetrics()">Get Metrics</button>
    <pre id="metrics"></pre>
  </section>
  <script>
    const base = '/api/v1';
    let sessionId = null;
    function startSession() {
      const userId = document.getElementById('userId').value;
      const duration = document.getElementById('duration').value;
      const fd = new FormData();
      fd.append('user_id', userId);
      fd.append('duration_minutes', duration);
      fd.append('schedule_type', 'start_end');
      fetch(`${base}/exam/session/start`, { method: 'POST', body: fd })
        .then(r => r.json()).then(j => { sessionId = j.session_id; document.getElementById('sessionInfo').innerText = JSON.stringify(j); });
    }
    function submitSession() {
      const userId = document.getElementById('userId').value;
      const fd = new FormData();
      fd.append('user_id', userId);
      fd.append('session_id', sessionId);
      fetch(`${base}/exam/session/submit`, { method: 'POST', body: fd })
        .then(r => r.json()).then(j => { document.getElementById('submitInfo').innerText = JSON.stringify(j); });
    }
    function verifyFace(phase) {
      const userId = document.getElementById('userId').value;
      const input = phase === 'start' ? document.getElementById('startFace') : document.getElementById('endFace');
      const fd = new FormData();
      fd.append('user_id', userId);
      fd.append('session_id', sessionId);
      fd.append('file', input.files[0]);
      fetch(`${base}/verify/authenticate/face/${phase}`, { method: 'POST', body: fd })
        .then(r => r.json()).then(j => {
          const el = phase === 'start' ? document.getElementById('startResult') : document.getElementById('endResult');
          el.innerText = JSON.stringify(j);
        });
    }
    function verifyVoice(phase) {
      const userId = document.getElementById('userId').value;
      const input = phase === 'start' ? document.getElementById('startVoice') : document.getElementById('endVoice');
      const fd = new FormData();
      fd.append('user_id', userId);
      fd.append('session_id', sessionId);
      fd.append('file', input.files[0]);
      fetch(`${base}/verify/authenticate/voice/${phase}`, { method: 'POST', body: fd })
        .then(r => r.json()).then(j => {
          const el = phase === 'start' ? document.getElementById('startResult') : document.getElementById('endResult');
          el.innerText = JSON.stringify(j);
        });
    }
    function getMetrics() {
      fetch(`${base}/exam/metrics/session/${sessionId}`).then(r => r.json()).then(j => { document.getElementById('metrics').innerText = JSON.stringify(j, null, 2); });
    }
  </script>
  </body>
  </html>
